---
title: 如何在 Power BI Premium 中配置工作负载
description: 了解如何在 Power BI 高级容量中配置工作负载。
author: mgblythe
ms.author: mblythe
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-admin
ms.topic: conceptual
ms.date: 08/21/2019
LocalizationGroup: Premium
ms.openlocfilehash: 2d2eb51c5aad44572f1b427248fd85ef19a6306f
ms.sourcegitcommit: e62889690073626d92cc73ff5ae26c71011e012e
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/23/2019
ms.locfileid: "69985709"
---
# <a name="configure-workloads-in-a-premium-capacity"></a>在高级容量中配置工作负载

本文介绍如何为 Power BI 高级容量启用和配置工作负载。 默认情况下，容量仅支持与正在运行的 Power BI 查询关联的工作负载。 还可以为 [AI（认知服务）](service-cognitive-services.md)  、[数据流](service-dataflows-overview.md#dataflow-capabilities-on-power-bi-premium)  和[分页报表](paginated-reports-save-to-power-bi-service.md)  启用和配置其他工作负载。

## <a name="default-memory-settings"></a>默认内存设置

查询工作负载针对由高级容量 SKU 确定的资源进行优化并受到这些资源的限制。 高级容量还支持可以使用容量资源的其他工作负载。 这些工作负载的默认内存值基于 SKU 可用的容量节点。 最大内存设置不是累计计算的。 为 AI 和数据流动态分配并为分页报表静态分配相当于最大指定值的内存。

### <a name="microsoft-office-skus-for-software-as-a-service-saas-scenarios"></a>用于软件即服务 (SaaS) 方案的 Microsoft Office SKU

|                     | EM2                      | EM3                       | P1                      | P2                       | P3                       |
|---------------------|--------------------------|--------------------------|-------------------------|--------------------------|--------------------------|
| AI | 不适用 | 不适用 | 默认为 20%，最低为 20% | 默认为 20%，最低为 10% | 默认为 20%，最低为 5% |
| 数据流 | 不适用 |默认为 20%，最低为 12%  | 默认为 20%，最低为 5%  | 默认为 20%，最低为 3% | 默认为 20%，最低为 2%  |
| 分页报表 | 不适用 |不适用 | 默认为 20%，最低为 10% | 默认为 20%，最低为 5% | 默认为 20%，最低为 2.5% |
| | | | | | |

### <a name="microsoft-azure-skus-for-platform-as-a-service-paas-scenarios"></a>用于平台即服务 (PaaS) 方案的 Microsoft Azure SKU

|                  | A1                       | A2                       | A3                      | A4                       | A5                      | A6                        |
|-------------------|--------------------------|--------------------------|-------------------------|--------------------------|-------------------------|---------------------------|
| AI | 不适用                      | 默认为 20%，最低为 100%                     | 默认为 20%，最低为 50%                     | 默认为 20%，最低为 20% | 默认为 20%，最低为 10% | 默认为 20%，最低为 5% |
| 数据流         | 默认为 40%，最低为 40% | 默认为 24%，最低为 24% | 默认为 20%，最低为 12% | 默认为 20%，最低为 5%  | 默认为 20%，最低为 3% | 默认为 20%，最低为 2%   |
| 分页报表 | 不适用                      | 不适用                      | 不适用                     | 默认为 20%，最低为 10% | 默认为 20%，最低为 5% | 默认为 20%，最低为 2.5% |
| | | | | | |

## <a name="workload-settings"></a>工作负载设置

### <a name="ai-preview"></a>AI（预览版）

通过 AI 工作负载，可在 Power BI 中使用认知服务和自动机器学习。 使用以下设置控制工作负载行为。

| 设置名称 | 说明 |
|---------------------------------|----------------------------------------|
| **最大内存(%)** | AI 进程可在容量中使用的最大可用内存百分比。 |
| **允许 Power BI Desktop 使用** | 此设置保留以供将来使用，且不会在所有租户中显示。 |
| **允许构建机器学习模型** | 指定业务分析师是否可直接在 Power BI 中训练、验证和调用机器学习模型。 有关详细信息，请参阅 [Power BI 中的自动机器学习（预览）](service-machine-learning-automated.md)。 |
| **为 AI 请求启用并行** | 指定 AI 请求是否可并行运行。 |
|  |  |

### <a name="datasets"></a>数据集

数据集工作负载默认启用，且无法禁用。 使用以下设置控制工作负载行为。

| 设置名称 | 说明 |
|---------------------------------|----------------------------------------|
| **最大内存(%)** | 数据集可在容量中使用的最大内存百分比。 |
| **XMLA 终结点** | 指定来自客户端应用程序的连接采用工作区和应用级别设置的安全组成员身份。 有关详细信息，请参阅[使用客户端应用程序和工具连接到数据集](service-premium-connect-tools.md)。 |
| 最大中间行设置计数  | DirectQuery 返回的最大中间行数。 默认值为 1000000，允许范围为 100000 - 2147483647。 使用此设置可控制资源密集型报表或设计不良报表的影响。 |
| 最大脱机数据集大小 (GB)  | 内存中脱机数据集的最大大小。 这是磁盘上的压缩大小。 默认值由 SKU 设置，允许范围为 0.1 – 10 GB。 使用此设置可防止报表创建者发布可能对容量产生负面影响的大型数据集。 |
| 最大结果行设置计数  | DAX 查询中返回的最大行数。 默认值为 -1（无限制），允许范围为 100000 - 2147483647。 使用此设置可控制资源密集型报表或设计不良报表的影响。 |
| 查询内存限制(%)  | 查询或 DAX 度量值中临时结果可使用的最大可用内存百分比。 使用此设置可控制资源密集型报表或设计不良报表的影响。 |
| 查询超时值(秒)  | 查询超时前允许的最长时间。默认值为 3600 秒（1 小时）。 值为 0 时表示查询不会超时。 使用此设置可更好地控制长时间运行的查询。 |
|  |  |  |

### <a name="dataflows"></a>数据流

通过数据流工作负载，可使用数据流自助数据准备功能来引入、转换、集成和扩充数据。 使用以下设置控制工作负载行为。

| 设置名称 | 说明 |
|---------------------------------|----------------------------------------|
| **最大内存(%)** | 数据流可在容量中使用的最大内存百分比。 |
| **增强的数据流计算引擎(预览版)** | 处理大规模数据量时，启用此选项可使计算实体的计算速度提高 20 倍。 **必须重启容量才能激活新引擎。** 有关详细信息，请参阅[增强的数据流计算引擎](#enhanced-dataflows-compute-engine)。 |
| **容器大小** | 数据流用于数据流中各实体的容器的最大大小。 默认值为 700 MB。 有关详细信息，请参阅[容器大小](#container-size)。 |
|  |  |

#### <a name="enhanced-dataflows-compute-engine"></a>增强的数据流计算引擎

为利用新计算引擎的优势，请将数据引入拆分到单独的数据流，并将转换逻辑置于不同数据流中的计算实体中。 推荐采用此方法，因为计算引擎处理引用现有数据流的数据流。 它不处理引入数据流。 遵循本指导可确保新计算引擎处理连接和合并等转换步骤时具备最优性能。

#### <a name="container-size"></a>容器大小

刷新数据流时，数据流工作负载会为数据流中的每个实体生成容器。 每个容器可占用的内存不得超过**“容器大小”设置中指定的内存量。 所有 SKU 的默认值均为 700 MB。 如果有以下情况，可能需要更改此设置：

- 数据流刷新时间过长，或者数据流在超时时刷新失败。
- 数据流实体包括联接等计算步骤。  

建议使用 [Power BI Premium 容量指标](service-admin-premium-monitor-capacity.md)应用来分析数据流工作负载的性能。

某些情况下，增加容器大小可能不会提高性能。 例如，如果数据流仅是从源获取数据，而不执行大量计算，那么更改容器大小可能不会有所帮助。 如果增加容器大小使数据流工作负载可以为实体刷新操作分配更多内存，那么这么做可能会有所帮助。 通过分配更多内存，可以减少刷新计算量很大的实体所需的时间。

“容器大小”值不能超过“数据流”工作负载的最大内存。 例如，P1 容量具有 25 GB 内存。 如果“数据流”工作负载“最大内存(%)” 设置为 20%，则“容器大小(MB)”不能超过 5000。 任何情况下，即便设置了更大的值，“容器大小”也无法超过“最大内存”。

### <a name="paginated-reports"></a>分页报表

通过分页报表工作负载，可在 Power BI 服务中基于标准 SQL Server Reporting Services 格式运行分页报表。 使用以下设置控制工作负载行为。

| 设置名称 | 说明 |
|---------------------------------|----------------------------------------|
| **最大内存(%)** | 分页报表可在容量中使用的最大内存百分比。 |
|  |  |

分页报表可在呈现报表时运行自定义代码。 例如，根据内容动态更改文本颜色会占用额外的内存。 Power BI Premium 在容量所含的空间中运行分页报表。 无论工作负载是否处于活动状态，系统都将使用指定的最大内存  。 如果要更改“最大内存”设置的默认值，请务必将其设置得足够小，以免对其他工作负载产生负面影响。

某些情况下，分页报表工作负载可能变得不可用。 在这种情况下，工作负载在管理门户中显示错误状态，并且用户会看到报表呈现的超时。 要缓解此问题，请禁用工作负载，然后再次启用它。

## <a name="configure-workloads"></a>配置工作负载

通过仅在需要时启用工作负载，最大限度地利用容量的可用资源。 仅在已确定默认设置不满足容量资源要求时更改内存和其他设置。

### <a name="to-configure-workloads-in-the-power-bi-admin-portal"></a>在 Power BI 管理门户中配置工作负载

1. 在“容量设置” > “高级容量”中，选择一个容量   。

1. 在“更多选项”  下，展开“工作负载”  。

1. 启用一个或多个工作负载，并设置“最大内存”和其他设置的值  。

1. 选择**应用**。

### <a name="rest-api"></a>REST API

可以使用[容量](https://docs.microsoft.com/rest/api/power-bi/capacities) REST API 启用工作负载并将其分配给容量。

## <a name="monitoring-workloads"></a>监视工作负载

[Power BI Premium 容量指标应用](service-admin-premium-monitor-capacity.md)提供数据集、数据流和分页报表指标，以监视为容量启用的工作负载。 

## <a name="next-steps"></a>后续步骤

[优化 Power BI Premium 容量](service-premium-capacity-optimize.md)     
[Power BI 中通过数据流自助进行数据准备](service-dataflows-overview.md)   
[Power BI Premium 中的分页报表是什么？](paginated-reports-report-builder-power-bi.md)   

更多问题？ [在 Power BI 社区提问](http://community.powerbi.com/)